<!DOCTYPE html>
<html lang="en" class="bg-gray-900">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Next-Gen Meta Ads Intelligence Hub</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js for interactive charts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <!-- Custom Google Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            color: #E5E7EB;
            background-color: #030712; /* Even darker, richer background */
        }
        .section-card {
             background: radial-gradient(circle at 100% 100%, #111827 0%, #030712 90%);
             border: 1px solid #1f2937;
             border-radius: 0.75rem;
             padding: 1.5rem;
             box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -2px rgba(0,0,0,0.05);
        }
        .kpi-card {
            background-color: #111827;
            border: 1px solid #374151;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        .kpi-card:before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0) 60%);
            transform: scale(0);
            transition: transform 0.5s ease;
        }
        .kpi-card:hover:before {
            transform: scale(2);
        }
        .kpi-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 25px -5px rgba(0,0,0,0.2), 0 10px 10px -5px rgba(0,0,0,0.1);
            border-color: #4f5b72;
        }
        .slider-thumb {
            -webkit-appearance: none; appearance: none; width: 20px; height: 20px;
            background: #2563EB; cursor: pointer; border-radius: 50%; border: 3px solid #F9FAFB;
        }
        input[type='range']::-webkit-slider-thumb { @apply slider-thumb; }
        input[type='range']::-moz-range-thumb { @apply slider-thumb; }
        .table-container { max-height: 400px; overflow-y: auto; }
        .table-container::-webkit-scrollbar { width: 8px; }
        .table-container::-webkit-scrollbar-track { background: transparent; }
        .table-container::-webkit-scrollbar-thumb { background-color: #374151; border-radius: 10px; }
        .chart-container { min-height: 350px; }
    </style>
</head>
<body class="p-4 sm:p-6 lg:p-8">
    <div class="max-w-screen-2xl mx-auto space-y-8">
        <!-- Header -->
        <header>
            <h1 class="text-4xl font-black text-white tracking-tighter">Next-Gen Ads Intelligence Hub</h1>
            <p class="text-gray-400 mt-2 text-lg">Harnessing data to drive predictive insights and strategic growth.</p>
        </header>

        <!-- Section 1: Interactive Filters -->
        <div class="section-card">
            <h2 class="text-xl font-bold text-white">Dashboard Controls</h2>
             <p class="text-gray-400 text-sm mt-1 mb-4"><strong>Business Need:</strong> To slice and dice data across different timeframes and campaign goals, enabling focused analysis on specific market conditions or strategic initiatives.</p>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                 <div>
                    <label for="date-slider" class="block mb-2 text-sm font-medium text-gray-300">Historical Date Range</label>
                    <div class="flex items-center space-x-4"><input id="date-slider" type="range" class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer"><span id="slider-date-label" class="text-sm font-semibold text-blue-300 bg-gray-700 px-3 py-1 rounded-md w-32 text-center"></span></div>
                </div>
                <div>
                    <label for="objective-filter" class="block mb-2 text-sm font-medium text-gray-300">Campaign Objective</label>
                    <select id="objective-filter" class="w-full bg-gray-800 border border-gray-600 text-white text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block p-2.5"><option value="All">All Objectives</option></select>
                </div>
            </div>
        </div>

        <!-- Section 2: Core Performance Overview -->
        <div class="section-card">
             <h2 class="text-xl font-bold text-white">Core Performance Snapshot</h2>
             <p class="text-gray-400 text-sm mt-1 mb-4"><strong>Business Need:</strong> To get a high-level, immediate understanding of the overall health and profitability of ad accounts for the selected period. These are the headline numbers for executive reporting.</p>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
                <div id="kpi-spent" class="kpi-card p-5 rounded-lg"></div>
                <div id="kpi-roas" class="kpi-card p-5 rounded-lg"></div>
                <div id="kpi-cpa" class="kpi-card p-5 rounded-lg"></div>
                <div id="kpi-purchases" class="kpi-card p-5 rounded-lg"></div>
            </div>
        </div>
        
        <!-- Section 3: Trend Analysis (Decoupled Charts) -->
        <div class="grid grid-cols-1 xl:grid-cols-2 gap-8">
            <div class="section-card">
                <h2 class="text-xl font-bold text-white">Revenue & Spend Over Time</h2>
                <p class="text-gray-400 text-sm mt-1 mb-4"><strong>Business Need:</strong> To track growth and budget pacing. This chart shows if revenue is scaling with investment, highlighting profitability trends.</p>
                <div class="chart-container"><canvas id="revenueTrendChart"></canvas></div>
            </div>
            <div class="section-card">
                <h2 class="text-xl font-bold text-white">Efficiency Metrics Over Time</h2>
                <p class="text-gray-400 text-sm mt-1 mb-4"><strong>Business Need:</strong> To monitor the cost-effectiveness of campaigns. Are we acquiring customers at a sustainable cost (CPA) and is the return (ROAS) healthy?</p>
                <div class="chart-container"><canvas id="efficiencyTrendChart"></canvas></div>
            </div>
        </div>

        <!-- Section 4: Advanced Analytics -->
        <div class="grid grid-cols-1 xl:grid-cols-5 gap-8">
            <div class="xl:col-span-3 section-card">
                 <h2 class="text-xl font-bold text-white">Conversion Funnel Analysis</h2>
                 <p class="text-gray-400 text-sm mt-1 mb-4"><strong>Business Need:</strong> To identify bottlenecks in the customer journey. A significant drop-off between stages (e.g., 'Add to Cart' to 'Purchase') indicates friction that needs to be addressed.</p>
                 <div class="chart-container"><canvas id="funnelChart"></canvas></div>
            </div>
            <div class="xl:col-span-2 section-card">
                <h2 class="text-xl font-bold text-white">Ad Fatigue Analysis (Frequency vs. CPA)</h2>
                <p class="text-gray-400 text-sm mt-1 mb-4"><strong>Business Need:</strong> To prevent over-exposing ads to the same audience, which leads to higher costs. This chart helps determine the optimal ad frequency before performance degrades.</p>
                <div class="chart-container"><canvas id="fatigueChart"></canvas></div>
            </div>
        </div>

        <!-- Section 5: Prediction & Forecasting Engine -->
        <div class="section-card">
            <h2 class="text-xl font-bold text-white">Prediction & Forecasting Engine</h2>
            <p class="text-gray-400 text-sm mt-1 mb-4"><strong>Business Need:</strong> To move from reactive to proactive management. This engine allows you to simulate the potential impact of budget and efficiency changes, helping to set realistic future targets and optimize spending.</p>
            <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-6 items-end">
                <div>
                    <label class="block text-sm font-medium text-gray-300">Spend Increase (%)</label>
                    <div class="flex items-center space-x-3 mt-2"><input id="spend-increase-slider" type="range" min="0" max="100" value="10" class="w-full h-2 bg-gray-700 rounded-lg"><span id="spend-increase-label" class="text-sm font-semibold text-green-300 bg-gray-700 px-3 py-1 rounded-md">10%</span></div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-300">CPA Change (%)</label>
                    <div class="flex items-center space-x-3 mt-2"><input id="cpa-change-slider" type="range" min="-50" max="50" value="0" class="w-full h-2 bg-gray-700 rounded-lg"><span id="cpa-change-label" class="text-sm font-semibold text-yellow-300 bg-gray-700 px-3 py-1 rounded-md">0%</span></div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-300">CVR Change (%)</label>
                    <div class="flex items-center space-x-3 mt-2"><input id="cvr-change-slider" type="range" min="-50" max="50" value="5" class="w-full h-2 bg-gray-700 rounded-lg"><span id="cvr-change-label" class="text-sm font-semibold text-sky-300 bg-gray-700 px-3 py-1 rounded-md">5%</span></div>
                </div>
                <div id="predicted-purchases" class="kpi-card p-4 rounded-lg text-center bg-blue-900/50 border-blue-700"></div>
                <div id="predicted-roas" class="kpi-card p-4 rounded-lg text-center bg-blue-900/50 border-blue-700"></div>
            </div>
        </div>

        <!-- Section 6: Detailed Campaign Breakdown -->
        <div class="section-card">
            <h2 class="text-xl font-bold text-white">Detailed Campaign Breakdown</h2>
            <p class="text-gray-400 text-sm mt-1 mb-4"><strong>Business Need:</strong> To perform granular analysis at the campaign level. This table helps identify top and bottom-performing campaigns, allowing for tactical optimization and budget reallocation.</p>
            <div class="table-container"><table class="min-w-full divide-y divide-gray-700"><thead class="bg-gray-800 sticky top-0"><tr><th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Campaign Name</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Amount Spent</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">ROAS</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Purchases</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">CPA</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">CTR (%)</th></tr></thead><tbody id="campaign-table-body" class="bg-gray-800 divide-y divide-gray-700"></tbody></table></div>
        </div>
    </div>

<script>
    // --- MOCK DATA GENERATION ---
    const mockData = [];
    const today = new Date('2025-10-17');
    const startDate = new Date(today);
    startDate.setDate(today.getDate() - 90);
    const campaignTemplates = [
        { name: 'Q4 Evergreen - Sales', objective: 'Sales' }, { name: 'Diwali Special Offer', objective: 'Sales' },
        { name: 'Lead Gen - Ebook Download', objective: 'Leads' }, { name: 'Brand Awareness - Fall Collection', objective: 'Awareness' },
    ];
    for (let d = new Date(startDate); d <= today; d.setDate(d.getDate() + 1)) {
        const dateStr = d.toISOString().split('T')[0];
        for (let i = 0; i < campaignTemplates.length; i++) {
            const template = campaignTemplates[i];
            const amountSpent = 50 + Math.random() * 150 * (Math.sin(d.getTime() / (1000 * 60 * 60 * 24 * 7)) + 1.5);
            const impressions = Math.floor(amountSpent * (200 + Math.random() * 100));
            const clicks = Math.floor(impressions * (0.01 + Math.random() * 0.02));
            const frequency = 1.2 + Math.random() * (4 + Math.sin(d.getDate()) * 3); // Frequency now varies more for fatigue chart
            const purchases = template.objective === 'Sales' ? Math.floor(clicks * (0.04 - (frequency * 0.005))) : 0; // CPA worsens with frequency
            const leads = template.objective === 'Leads' ? Math.floor(clicks * (0.1 + Math.random() * 0.05)) : 0;
            const purchaseRevenue = purchases * (80 + Math.random() * 40);
            mockData.push({
                "Date": dateStr, "Campaign ID": 1000 + i, "Campaign Name": template.name, "Ad Set ID": 2000+i, "Ad Set Name": `Audience ${i+1}`, "Ad ID": 3000+i, "Ad Name": `Video Ad ${i+1}`, "Campaign Objective": template.objective, "Status": "Active", "Amount Spent": amountSpent, "Impressions": impressions, "Reach": Math.floor(impressions / frequency), "Frequency": frequency, "CPM": (amountSpent / impressions) * 1000, "Link Clicks": clicks, "Outbound Clicks": Math.floor(clicks * 0.9), "CTR (Link Click-Through)": (clicks / impressions) * 100, "CPC (Cost Per Click)": clicks > 0 ? amountSpent / clicks : 0, "Adds to Cart": Math.floor(clicks * 0.3), "Initiates Checkout": Math.floor(clicks * 0.15), "Purchases": purchases, "Leads": leads, "Conversion Rate (%)": purchases > 0 && clicks > 0 ? (purchases / clicks) * 100 : 0, "CPA (Cost Per Purchase)": purchases > 0 ? amountSpent / purchases : 0, "Purchase Revenue": purchaseRevenue, "ROAS (Return On Ad Spend)": amountSpent > 0 ? purchaseRevenue / amountSpent : 0,
            });
        }
    }
    
    // --- UTILITY FUNCTIONS & CHART DEFAULTS ---
    const formatCurrency = (v) => isNaN(v) ? '$0.00' : v.toLocaleString('en-US', { style: 'currency', currency: 'USD' });
    const formatNumber = (v) => isNaN(v) ? '0' : v.toLocaleString('en-US', { maximumFractionDigits: 0 });
    const formatROAS = (v) => isNaN(v) ? '0.00x' : `${v.toFixed(2)}x`;
    Chart.defaults.color = '#9CA3AF';
    Chart.defaults.borderColor = '#374151';

    // --- GLOBAL CHART VARIABLES ---
    let revenueTrendChart, efficiencyTrendChart, funnelChart, fatigueChart;

    // --- DOM ELEMENT REFERENCES ---
    const dateSlider = document.getElementById('date-slider');
    const sliderDateLabel = document.getElementById('slider-date-label');
    const objectiveFilter = document.getElementById('objective-filter');
    const spendIncreaseSlider = document.getElementById('spend-increase-slider');
    const spendIncreaseLabel = document.getElementById('spend-increase-label');
    const cpaChangeSlider = document.getElementById('cpa-change-slider');
    const cpaChangeLabel = document.getElementById('cpa-change-label');
    const cvrChangeSlider = document.getElementById('cvr-change-slider');
    const cvrChangeLabel = document.getElementById('cvr-change-label');
    
    // --- CORE LOGIC ---
    function getFilteredData() {
        const uniqueDates = [...new Set(mockData.map(d => d.Date))].sort();
        const selectedDate = uniqueDates[dateSlider.value];
        const selectedObjective = objectiveFilter.value;
        return mockData.filter(d => (d.Date <= selectedDate) && (selectedObjective === 'All' || d['Campaign Objective'] === selectedObjective));
    }
    
    function updateDashboard() {
        const data = getFilteredData();
        updateKpiCards(data);
        updateRevenueTrendChart(data);
        updateEfficiencyTrendChart(data);
        updateFunnelChart(data);
        updateFatigueChart(data);
        updateDetailedTable(data);
        updatePredictionEngine(data);
    }
    
    // --- UPDATE FUNCTIONS ---
    function updateKpiCards(data) {
        const totals = data.reduce((acc, curr) => {
            acc.spent += curr['Amount Spent']; acc.revenue += curr['Purchase Revenue']; acc.purchases += curr['Purchases']; return acc;
        }, { spent: 0, revenue: 0, purchases: 0 });
        const roas = totals.spent > 0 ? totals.revenue / totals.spent : 0;
        const cpa = totals.purchases > 0 ? totals.spent / totals.purchases : 0;
        const createKpiHtml = (title, value) => `<p class="text-base font-medium text-gray-400 truncate">${title}</p><p class="mt-1 text-4xl font-extrabold text-white">${value}</p>`;
        document.getElementById('kpi-spent').innerHTML = createKpiHtml('Total Spend', formatCurrency(totals.spent));
        document.getElementById('kpi-roas').innerHTML = createKpiHtml('Overall ROAS', formatROAS(roas));
        document.getElementById('kpi-cpa').innerHTML = createKpiHtml('Average CPA', formatCurrency(cpa));
        document.getElementById('kpi-purchases').innerHTML = createKpiHtml('Total Purchases', formatNumber(totals.purchases));
    }

    function updateRevenueTrendChart(data) {
        const byDate = data.reduce((acc, curr) => {
            if (!acc[curr.Date]) acc[curr.Date] = { spent: 0, revenue: 0 };
            acc[curr.Date].spent += curr['Amount Spent']; acc[curr.Date].revenue += curr['Purchase Revenue']; return acc;
        }, {});
        const labels = Object.keys(byDate).sort();
        const revenueData = labels.map(date => byDate[date].revenue);
        const spentData = labels.map(date => byDate[date].spent);
        const chartData = {
            labels: labels, datasets: [
                { type: 'bar', label: 'Spend', data: spentData, backgroundColor: 'rgba(59, 130, 246, 0.5)', borderColor: 'rgba(59, 130, 246, 0.8)' },
                { type: 'line', label: 'Revenue', data: revenueData, borderColor: '#10B981', backgroundColor: '#10B98120', tension: 0.4, fill: true, yAxisID: 'y1' }
            ]
        };
        const chartOptions = { responsive: true, maintainAspectRatio: false, interaction: { mode: 'index', intersect: false }, scales: { x: { type: 'time', time: { unit: 'week' } }, y: { stacked: true, title: { display: true, text: 'Spend ($)'} }, y1: { position: 'right', grid: { drawOnChartArea: false }, title: { display: true, text: 'Revenue ($)'} } }, plugins: { legend: { position: 'top' } } };
        if (revenueTrendChart) { revenueTrendChart.data = chartData; revenueTrendChart.update(); } 
        else { revenueTrendChart = new Chart(document.getElementById('revenueTrendChart'), { data: chartData, options: chartOptions }); }
    }

    function updateEfficiencyTrendChart(data) {
        const byDate = data.reduce((acc, curr) => {
            if (!acc[curr.Date]) acc[curr.Date] = { spent: 0, revenue: 0, purchases: 0 };
            acc[curr.Date].spent += curr['Amount Spent']; acc[curr.Date].revenue += curr['Purchase Revenue']; acc[curr.Date].purchases += curr['Purchases']; return acc;
        }, {});
        const labels = Object.keys(byDate).sort();
        const roasData = labels.map(d => byDate[d].spent > 0 ? byDate[d].revenue / byDate[d].spent : 0);
        const cpaData = labels.map(d => byDate[d].purchases > 0 ? byDate[d].spent / byDate[d].purchases : 0);
        const chartData = {
            labels, datasets: [
                { label: 'ROAS', data: roasData, borderColor: '#2563EB', tension: 0.4, yAxisID: 'y' },
                { label: 'CPA ($)', data: cpaData, borderColor: '#FBBF24', tension: 0.4, yAxisID: 'y1' }
            ]
        };
        const chartOptions = { responsive: true, maintainAspectRatio: false, interaction: { mode: 'index', intersect: false }, scales: { x: { type: 'time', time: { unit: 'week' } }, y: { position: 'left', title: { display: true, text: 'ROAS' } }, y1: { position: 'right', grid: { drawOnChartArea: false }, title: { display: true, text: 'CPA ($)' } } }, plugins: { legend: { position: 'top' } } };
        if (efficiencyTrendChart) { efficiencyTrendChart.data = chartData; efficiencyTrendChart.update(); } 
        else { efficiencyTrendChart = new Chart(document.getElementById('efficiencyTrendChart'), { type: 'line', data: chartData, options: chartOptions }); }
    }

    function updateFunnelChart(data) {
        const totals = data.reduce((acc, curr) => {
            acc.impressions += curr.Impressions; acc.clicks += curr['Link Clicks']; acc.atc += curr['Adds to Cart']; acc.checkout += curr['Initiates Checkout']; acc.purchases += curr.Purchases; return acc;
        }, { impressions: 0, clicks: 0, atc: 0, checkout: 0, purchases: 0 });
        const chartData = {
            labels: ['Impressions', 'Link Clicks', 'Adds to Cart', 'Checkouts', 'Purchases'],
            datasets: [{
                label: 'Conversion Funnel', data: [totals.impressions, totals.clicks, totals.atc, totals.checkout, totals.purchases],
                backgroundColor: ['#1E3A8A', '#1E40AF', '#1D4ED8', '#2563EB', '#3B82F6']
            }]
        };
        const chartOptions = { indexAxis: 'y', responsive: true, maintainAspectRatio: false, scales: { x: { type: 'logarithmic' } }, plugins: { legend: { display: false }, title: { display: true, text: 'Customer Journey (Logarithmic Scale)' } } };
        if (funnelChart) { funnelChart.data = chartData; funnelChart.update(); } 
        else { funnelChart = new Chart(document.getElementById('funnelChart'), { type: 'bar', data: chartData, options: chartOptions }); }
    }

    function updateFatigueChart(data) {
        const salesData = data.filter(d => d['Campaign Objective'] === 'Sales' && d.Purchases > 0);
        const scatterData = salesData.map(d => ({ x: d.Frequency, y: d['CPA (Cost Per Purchase)'] }));
        const chartData = { datasets: [{ label: 'CPA by Frequency', data: scatterData, backgroundColor: 'rgba(236, 72, 153, 0.6)' }] };
        const chartOptions = { responsive: true, maintainAspectRatio: false, scales: { x: { type: 'linear', position: 'bottom', title: { display: true, text: 'Ad Frequency' } }, y: { title: { display: true, text: 'CPA ($)' } } }, plugins: { legend: { display: false } } };
        if (fatigueChart) { fatigueChart.data = chartData; fatigueChart.update(); } 
        else { fatigueChart = new Chart(document.getElementById('fatigueChart'), { type: 'scatter', data: chartData, options: chartOptions }); }
    }

    function updateDetailedTable(data) {
        const selectedDate = [...new Set(mockData.map(d => d.Date))].sort()[dateSlider.value];
        const latestData = data.filter(d => d.Date === selectedDate);
        const summary = latestData.reduce((acc, curr) => {
            const name = curr['Campaign Name'];
            if (!acc[name]) acc[name] = { spent: 0, revenue: 0, purchases: 0, clicks: 0, impressions: 0 };
            acc[name].spent += curr['Amount Spent']; acc[name].revenue += curr['Purchase Revenue']; acc[name].purchases += curr['Purchases']; acc[name].clicks += curr['Link Clicks']; acc[name].impressions += curr['Impressions']; return acc;
        }, {});
        const tableBody = document.getElementById('campaign-table-body');
        tableBody.innerHTML = Object.entries(summary).map(([name, totals]) => {
            const roas = totals.spent > 0 ? totals.revenue / totals.spent : 0;
            const cpa = totals.purchases > 0 ? totals.spent / totals.purchases : 0;
            const ctr = totals.impressions > 0 ? (totals.clicks / totals.impressions) * 100 : 0;
            return `<tr class="hover:bg-gray-700/50"><td class="px-6 py-4 text-sm font-medium text-white">${name}</td><td class="px-6 py-4 text-sm text-gray-300">${formatCurrency(totals.spent)}</td><td class="px-6 py-4 text-sm text-gray-300">${formatROAS(roas)}</td><td class="px-6 py-4 text-sm text-gray-300">${formatNumber(totals.purchases)}</td><td class="px-6 py-4 text-sm text-gray-300">${formatCurrency(cpa)}</td><td class="px-6 py-4 text-sm text-gray-300">${ctr.toFixed(2)}%</td></tr>`;
        }).join('');
    }

    function updatePredictionEngine(data) {
        if (data.length === 0) return;
        const salesData = data.filter(d => d['Campaign Objective'] === 'Sales');
        const totals = salesData.reduce((acc, curr) => {
            acc.spent += curr['Amount Spent']; acc.purchases += curr['Purchases']; acc.revenue += curr['Purchase Revenue']; acc.clicks += curr['Link Clicks']; return acc;
        }, { spent: 0, purchases: 0, revenue: 0, clicks: 0 });
        const histCpa = totals.purchases > 0 ? totals.spent / totals.purchases : 0;
        const histCvr = totals.clicks > 0 ? totals.purchases / totals.clicks : 0;
        const aov = totals.purchases > 0 ? totals.revenue / totals.purchases : 50;
        const spendIncr = parseFloat(spendIncreaseSlider.value) / 100, cpaChg = parseFloat(cpaChangeSlider.value) / 100, cvrChg = parseFloat(cvrChangeSlider.value) / 100;
        const futureSpend = totals.spent * (1 + spendIncr);
        const futureCvr = histCvr * (1 + cvrChg);
        const futureCpa = histCpa * (1 + cpaChg);
        const predictedPurchases = futureCpa > 0 ? futureSpend / futureCpa : 0; // Simple model, could be improved
        const predictedRevenue = predictedPurchases * aov;
        const predictedRoas = futureSpend > 0 ? predictedRevenue / futureSpend : 0;
        const createKpiHtml = (title, value) => `<p class="text-sm font-medium text-gray-300">${title}</p><p class="mt-1 text-2xl font-bold text-white">${value}</p>`;
        document.getElementById('predicted-purchases').innerHTML = createKpiHtml('Predicted Purchases', formatNumber(predictedPurchases));
        document.getElementById('predicted-roas').innerHTML = createKpiHtml('Predicted ROAS', formatROAS(predictedRoas));
    }

    // --- INITIALIZATION ---
    function init() {
        const objectives = [...new Set(mockData.map(d => d['Campaign Objective']))];
        objectives.forEach(obj => { objectiveFilter.innerHTML += `<option value="${obj}">${obj}</option>`; });
        const uniqueDates = [...new Set(mockData.map(d => d.Date))].sort();
        dateSlider.max = uniqueDates.length - 1; dateSlider.value = uniqueDates.length - 1;
        const updateDateLabel = () => { sliderDateLabel.textContent = new Date(uniqueDates[dateSlider.value]).toLocaleDateString('en-US', { month: 'short', day: 'numeric' }); };
        dateSlider.addEventListener('input', () => { updateDateLabel(); updateDashboard(); });
        objectiveFilter.addEventListener('change', updateDashboard);
        [spendIncreaseSlider, cpaChangeSlider, cvrChangeSlider].forEach(slider => slider.addEventListener('input', () => updatePredictionEngine(getFilteredData())));
        spendIncreaseSlider.addEventListener('input', (e) => spendIncreaseLabel.textContent = `${e.target.value}%`);
        cpaChangeSlider.addEventListener('input', (e) => cpaChangeLabel.textContent = `${e.target.value}%`);
        cvrChangeSlider.addEventListener('input', (e) => cvrChangeLabel.textContent = `${e.target.value}%`);
        updateDateLabel();
        updateDashboard();
    }
    document.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>

